# Documentation Guidelines

## README Structure

All Terraform modules must follow the **ultra-minimal README** structure with sections in this exact order:

```markdown
# Module Name

Brief description (1-2 sentences)

## Features

- Feature 1
- Feature 2
(max 8 features)

## Quick Start

```hcl
module "name" {
  source = "github.com/llamandcoco/infra-modules//terraform/name?ref=<commit-sha>"

  # Add required variables
}
```

**Note:** Use commit SHA instead of version tags (e.g., `?ref=abc123def`) until a release policy is established.

## Examples

Complete, tested configurations in [`tests/`](tests/):

| Example | Directory |
|---------|-----------|
| Example Name | [`tests/example/`](tests/example/) |

**Usage:**
```bash
# View example
cat tests/example/main.tf

# Copy and adapt
cp -r tests/example/ my-project/
```

## Testing

```bash
cd tests/example && terraform init && terraform plan
```

<!-- BEGIN_TF_DOCS -->
(auto-generated by terraform-docs)
<!-- END_TF_DOCS -->
```

### Required Section Order

**Sections must appear in this exact order:**

1. **Title** (`# Module Name`)
2. **Description** (1-2 sentence paragraph)
3. **Features** (`## Features`)
4. **Quick Start** (`## Quick Start`)
5. **Examples** (`## Examples`)
6. **Testing** (`## Testing`)
7. **Terraform Docs** (`<!-- BEGIN_TF_DOCS -->`)

**Do not add additional sections or reorder these sections.**

---

## Rules

### ✅ **DO**

1. **Keep descriptions brief** - 1-2 sentences max
2. **Limit features** - Top 8 most important features only
3. **Reference tests/** - All code examples live in test directories
4. **Use examples table** - Link to test directories, don't duplicate code
5. **Keep it simple** - Aim for 100-200 lines total (excluding terraform-docs)
6. **Run terraform-docs** - Auto-generate inputs/outputs documentation

### ❌ **DON'T**

1. **Don't duplicate code** - Never copy test configurations into README
2. **Don't add verbose guides** - No usage tutorials, best practices sections, or walkthroughs
3. **Don't embed examples** - No full HCL blocks in README (except Quick Start)
4. **Don't document AWS** - Don't explain AWS services, link to AWS docs instead
5. **Don't create examples/** - Use `tests/` directory for examples
6. **Don't exceed 8 features** - Keep feature list concise

---

## Creating a New Module

1. **Copy the template:**
   ```bash
   cp -r terraform/_template terraform/new-module
   ```

2. **Write the code** - Create your `.tf` files

3. **Create test examples:**
   ```bash
   mkdir -p terraform/new-module/tests/basic
   # Add main.tf with complete working example
   ```

4. **Write the README:**
   - Add module name and description
   - List top 8 features
   - Add Quick Start with minimal example
   - Create examples table referencing `tests/`
   - Run `terraform-docs` to generate the rest

5. **Generate terraform-docs:**
   ```bash
   cd terraform/new-module
   terraform-docs markdown table . > README_temp.md
   # Manually merge with your README
   ```

---

## Updating an Existing Module

### When adding a feature:

1. **Update the code**
2. **Add test example** in `tests/new-feature/`
3. **Update README:**
   - Add to features list (if room)
   - Add row to examples table
4. **Regenerate terraform-docs** if inputs/outputs changed

### When fixing a bug:

1. **Update the code**
2. **Update test** if needed
3. **No README changes** unless inputs/outputs changed
4. **Regenerate terraform-docs** if needed

---

## Examples Directory Structure

```
terraform/module-name/
├── main.tf
├── variables.tf
├── outputs.tf
├── README.md
└── tests/
    ├── basic/              # Minimal working example
    │   └── main.tf
    ├── advanced/           # Advanced features
    │   └── main.tf
    └── production/         # Production-ready config
        └── main.tf
```

**Each test should:**
- Be a complete, working Terraform configuration
- Use mock provider for testing without AWS credentials
- Demonstrate a specific use case
- Include outputs to verify functionality

---

## terraform-docs Configuration

Use the `.terraform-docs.yml` config in the repo root:

```bash
# Generate docs for a module
cd terraform/module-name
terraform-docs markdown table . --output-file README_DOCS.md
```

Then manually insert between `<!-- BEGIN_TF_DOCS -->` and `<!-- END_TF_DOCS -->` markers.

---

## Quick Reference

### Target README Size

- **Simple modules** (vpc, subnet, etc.): 80-120 lines
- **Medium modules** (s3, dynamodb, etc.): 100-150 lines
- **Complex modules** (ec2, alb, eks, etc.): 150-200 lines

Excluding terraform-docs auto-generated content.

### Examples Table Format

```markdown
| Example | Directory |
|---------|-----------|
| Basic Configuration | [`tests/basic/`](tests/basic/) |
| Advanced Features | [`tests/advanced/`](tests/advanced/) |
| Production Setup | [`tests/production/`](tests/production/) |
```

### Quick Start Format

```hcl
module "short_name" {
  source = "github.com/llamandcoco/infra-modules//terraform/module?ref=<commit-sha>"

  # Only required variables
  name = "example"
}
```

---

## Before Committing

**Checklist:**

- [ ] README follows ultra-minimal structure
- [ ] Description is 1-2 sentences
- [ ] Features list has ≤8 items
- [ ] Quick Start is minimal (required vars only)
- [ ] Examples table links to all test directories
- [ ] No code duplication (tests are the examples)
- [ ] terraform-docs section is current
- [ ] README is under 200 lines (excluding terraform-docs)
- [ ] Tests are working and complete

---

## Philosophy

**"Tests are the documentation."**

- Write comprehensive, working examples in `tests/`
- README is just a **guide** pointing to those examples
- Don't duplicate - reference
- Keep it simple and scannable
- Let terraform-docs handle the details

This approach ensures:
- ✅ Examples are always up-to-date (CI tests them)
- ✅ No duplication between docs and code
- ✅ Easier maintenance
- ✅ Faster navigation
- ✅ Consistent structure across all modules
